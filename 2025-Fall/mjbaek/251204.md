# **Limosilactobacillus fermentum Pan-Genome & Functional COG Analysis**

## **Background**
*Limosilactobacillus fermentum*은 다양한 식품 발효 과정에 관여하는 대표적인 젖산균( LAB )으로, 탄수화물 대사·유기산 생성·내산성 등 발효 관련 특성을 보유한 균주이다.  
같은 종(*L. fermentum*) 내에서도 계통적 변이와 기능적 다양성이 존재할 수 있으며, 특히 **발효 대사 관련 유전자(탄수화물 분해·에너지 생산·스트레스 내성·산생성 등)** 의 차이는 발효 특성의 변화를 야기할 수 있다.

본 분석에서는 **ANI/AAI 기반 클러스터링을 통해 신뢰할 수 있는 동일 종 그룹을 확정한 뒤**,  
**Accessory gene 기능(특히 COG 카테고리) 분포가 클러스터 간 차이를 보이는지 통계적으로 탐색하는 것**을 목표로 하였다.

---

# **1. ANI·AAI 기반 품질 필터링 및 클러스터 안정화**

## **1.1 Pairwise Similarity Data Processing**
### **(1) 데이터 구조 정리**
- ANI / AAI 분석 결과를 모두 `GenomeA, GenomeB, Value` 형태의 pairwise 테이블로 변환.
- 대칭쌍(A–B, B–A) 제거 → 중복 없는 관계만 유지.

### **(2) 공통쌍 추출 & 병합**
- `pd.merge()`를 활용하여 **inner join**, 공통된 genome pair만 유지.
- 총 가능한 pair: **155개 genome → 11,935쌍**  
  - ANI: 11,935쌍  
  - AAI: 11,781쌍 (특정 FASTA 파일 오류로 일부 누락)

### **(3) ANI–AAI 불일치 탐지**
- `abs_diff = |ANI - AAI|`
- `flag = (ANI ≥ 95% and AAI < 95%) OR (ANI < 95% and AAI ≥ 95%)`
- 불일치 쌍만 추출하여 **low-consistency 그룹**으로 분리.

### **(4) Low-ANI Genome Detection and remove redundant entries**
- **AP017974.1**이 low-ANI pair에서 **308회 등장** → 구조적 변이 또는 다른 계통 가능성.
- 해당 ID 제외 + Complete chromosome 수준만 선별(NCBI에서 확보한 데이터는 CP033371.1, NZ_CP033371.1 이렇게 ID라벨링이 다르게 되어있음. CP만이 Complete chromosome 수준)→ **신뢰 가능한 genome set = 81개**

🔗 **Low-ANI pairs file:**  
`low_ani_outlier_pairs.csv`  
<https://github.com/igchoi/IBT610-CompGen/blob/c7f2158e09483995fcbe89c653a3632d4fc43d5f/2025-Fall/mjbaek/low_ani_outlier_pairs.csv>
**→ AP017974.1 제외 후 81개 genome을 pan-genome 분석에 사용.**

---
#**2. 해당 ID들을 기준으로 meta data ncbi에서 확보**



# **3. Pan-Genome Construction & Accessory Gene Annotation**

## **3.1 Genome Annotation**
- 81개 FASTA 파일을 **Prokka**로 annotation → `.gff` 파일 생성.

## **3.2 Pan-Genome Analysis (Roary)**
- 입력: 81개의 `.gff`  
- 출력:  
  - `gene_presence_absence.csv` (유전자 존재/부재 매트릭스)  
  - `clustered_proteins` 등  
- 확인 결과:  
  - **CP033371.1**이 다수 유전자에서 단독 결손 → outlier  
  - **CP033371.1은 downstream analysis에서 제외**

## **3.3 Accessory Gene Set 만들기**
- Roary matrix에서 **95% 미만 존재 빈도 (shell + cloud)** 유전자만 추출 →  
  **`accessory_genes.list` 생성**

## **3.4 EggNOG Functional Annotation 매핑**
- EggNOG 결과 파일 81개를 하나로 merge → `eggnog_all_merged.tsv`
- `accessory_genes.list` 기준으로 subset → `accessory_eggnog_annotations.tsv`

---

# **4. COG Functional Categorization**

## **왜 COG을 선택했는가?**
- KEGG Pathway 컬럼이 실제 metabolic pathway명을 포함하지 않는 경우가 많았음  
- KO/EC/Description만으로 발효 관련 효소를 자동 분류하기 어렵기 때문  
- COG은 기능별 카테고리화가 가장 잘 정리되어 있어 **클러스터 간 기능적 차이를 비교하기 최적**

## **처리 과정**
1. EggNOG 결과에서 COG category만 추출  
2. accessory gene presence/absence matrix와 merge  
3. genome별 COG category count 생성  
   → `genome_cog_category_counts.tsv`

---

# **5. Phylogenetic Analysis based on COG-C,E,G(fermentation related gene category)**
- accessory gene 기반 거리 행렬을 사용해 Tree 생성  
- 클러스터 구분과 기능적 COG 패턴 비교를 위한 시각화용으로 활용

---



---

필요하면 **그림 추가용 템플릿**, **폴더 구조 템플릿**, **빔버노트용 description** 도 만들어줄게!
