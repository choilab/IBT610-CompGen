# **Lactobacillus fermentum Pan-Genome Analysis Report**

## **Title**

**Construction of *Lactobacillus fermentum* phylogroup Based on Accessory Gene Clustering**

---

## **Objective**

본 프로젝트의 목적은 80개의 *Lactobacillus fermentum* 전체 유전체 데이터를 기반으로 **pan-genome 분석**을 수행하고, **accessory gene 기반의 클러스터링을 통해 phylogroup(H35)을 나누고, 각 그룹이 **발효 관련 기능(C/G/E)** 관점에서 서로 다른 유전자 패턴을 가지는지 평가**하는 것이다. 
---

## **3. Background**

Lactobacillus fermentum은 유산균(Lactic Acid Bacteria, LAB) 계열에 속하는 그람양성 혐기성/통성혐기성 박테리아로, 다양한 발효식품(치즈, 김치, 요구르트 등)과 인간 및 동물의 점막(위장관, 구강, 비뇨생식계)에서 흔히 분리된다. 본 종은 다음과 같은 특성과 연구적/산업적 가치를 지닌다:

* **생태·응용적 중요성**: 전통 발효식품의 핵심 구성 미생물 중 하나로서 발효 특성, 유기산(주로 젖산) 생성, 엑소다당류(예: EPS) 생성, 그리고 항균물질(박테리오신) 합성 등으로 식품 품질 및 보존성에 영향을 준다.

* **프로바이오틱 잠재력**: 장벽 강화, 병원성 억제 및 면역조절과 관련한 여러 연구에서 프로바이오틱 특성이 보고되었다.

* **유전체 크기 및 유전정보**: 공개된 L. fermentum 완전체/초안 유전체의 평균 크기는 약 **~1.9–2.1 Mbp** 범위, 평균 CDS(예상 단백질 코딩 유전자) 수는 연구별로 **약 1,800–2,100개** 수준으로 보고된다. 

* **유전적 다양성의 의미**: L. fermentum은 분리원(치즈, 발효채소, 유제품, 사람 유래 등)에 따라 accessory genome에서 큰 차이를 보이는 경향이 있어(Zhao, Yan, et al.2022), accessory genome에 대한 분석이 중요하다.
---

# **1. ANI·AAI 기반 품질 필터링 및 클러스터 안정화**

## **1.1 Pairwise Similarity Data Processing**
### **(1) 데이터 구조 정리**
- ANI / AAI 분석 결과를 모두 `GenomeA, GenomeB, Value` 형태의 pairwise 테이블로 변환.
- 대칭쌍(A–B, B–A) 제거 → 중복 없는 관계만 유지.

### **(2) 공통쌍 추출 & 병합**
- `pd.merge()`를 활용하여 **inner join**, 공통된 genome pair만 유지.
- 총 가능한 pair: **155개 genome → 11,935쌍**  
  - ANI: 11,935쌍  

### **(3) Low-ANI Genome Detection and remove redundant entries**
- **AP017974.1**이 low-ANI pair에서 **308회 등장** → 구조적 변이 또는 다른 계통 가능성.
- 해당 ID 제외 + 대칭쌍(A–B, B–A) 제거 + Complete chromosome 수준만 선별(NCBI에서 확보한 데이터는 CP033371.1, NZ_CP033371.1 이렇게 ID라벨링이 다르게 되어있음. CP만이 Complete chromosome 수준)→ **신뢰 가능한 genome set = 81개**

🔗 **Low-ANI pairs file:**  
`low_ani_outlier_pairs.csv`  
<https://github.com/igchoi/IBT610-CompGen/blob/c7f2158e09483995fcbe89c653a3632d4fc43d5f/2025-Fall/mjbaek/low_ani_outlier_pairs.csv>
**→ AP017974.1 제외 후 81개 genome을 pan-genome 분석에 사용.**

---
# **2. 해당 ID들을 기준으로 meta data ncbi에서 확보**
<https://github.com/minjBaek02/file_collection/blob/7fbeae435665bb2e288639ce7ee23774b7632475/%EA%B9%83%ED%97%88%EB%B8%8C%20%EC%97%85%EB%A1%9C%EB%93%9C%20%ED%8C%8C%EC%9D%BC/biosample_metadata_81_sort.csv>

---

# **3. Pan-Genome Construction & Accessory Gene Annotation**

## **3.1 Genome Annotation**
- 81개 FASTA 파일을 **Prokka**로 annotation → `.gff` 파일 생성.

## **3.2 Pan-Genome Analysis (Roary)**
- 입력: 81개의 `.gff`  
- 출력:  
  - `gene_presence_absence.csv` (유전자 존재/부재 매트릭스)  
  - `clustered_proteins` 등  
- 확인 결과:  
  - **CP033371.1**이 다수 유전자에서 단독 결손 → outlier  
  - **CP033371.1은 downstream analysis에서 제외**

## **3.3 Accessory Gene Set 만들기**
- Roary matrix에서 **95% 미만 존재 빈도 (shell + cloud)** 유전자만 추출 →  
  **`accessory_genes.list` 생성**

## **3.4 EggNOG Functional Annotation 매핑**
- EggNOG 결과 파일 81개를 하나로 merge → `eggnog_all_merged.tsv`
- `accessory_genes.list` 기준으로 subset → `accessory_eggnog_annotations.tsv`

---

# **4. COG Functional Categorization**

## **왜 COG을 선택했는가?**
- KEGG Pathway 컬럼이 실제 metabolic pathway명을 포함하지 않는 경우가 많았음  
- KO/EC/Description만으로 발효 관련 효소를 자동 분류하기 어렵기 때문  
- COG은 기능별 카테고리화가 가장 잘 정리되어 있어 **클러스터 간 기능적 차이를 비교하기 최적**

## **처리 과정**
1. EggNOG 결과에서 COG category만 추출  
2. accessory gene presence/absence matrix와 merge  
3. genome별 COG category count 생성  
   → `genome_cog_category_counts.tsv`

---

# **5. Phylogenetic Analysis based on COG-C,E,G(fermentation related gene category)**

## **분석에서 핵심적으로 본 COG 카테고리**
- **C**: Energy production & conversion  
- **G**: Carbohydrate transport & metabolism  
- **E**: Amino acid transport & metabolism  
(발효 LAB 연구에서 가장 중요하게 다루는 기능 그룹)

## **Visualization with iTOL**
- Roary presence/absence matrix 기반으로 **accessory gene phylogeny (Newick)** 생성  
- COG category count + metadata를 iTOL annotation 파일로 변환  
- iTOL에서  
  1) **Accessory gene tree**  
  2) **COG C,G,E category bar**
  3) **meta data**
  를 함께 시각화하여 cluster별 기능적 차이 확인함

---

### Hypothesis 1
발효 관련 기능에 중요한 COG 카테고리(C, G, E)는 **환경 기반 계통 구조(phylogroup)에 따라 유의적으로 차이가 난다**는 가설을 세웠다.

즉, **발효 적응성의 기능적 분화가 accessory gene 구성 차이로 나타날 것**이라는 예상이다.

**가설의 참고 근거**
-Li et al. (2024) -> 유산균(LAB)에서 발효 관련 기능이 accessory gene에 집중되어 있으며, 계통에 따라 다르게 분포함.

-Mejía-Caballero et al. (2025) -> 1020개 Lactobacillus 균주를 대상으로 환경 기반 계통과 기능적 적응 분석. 계통에 따라 환경 적응 관련 유전자(발효, 대사 등)가 다르게 나타남.

---

## 7. Phylogroup Construction (H35 Cut)

### 7.1 Why H35?
Roary accessory gene matrix 기반 phylogeny를 height로 클러스터링했을 때:

- H20 이하 → 과도하게 세분화
- H45~H50 → 과하게 병합
- **H35 → 계통적/기능적 패턴이 가장 일관적이며 5개 phylogroup으로 안정적 분리됨**

결과 파일: **`phylogroup_h35.tsv`**

---

## 8. Statistical Tests for Functional Differences (C/G/E)
'나눠진 5개의 그룹의 발효 관련 유전자 카데고리 C, G, E의 분포는 각 그룹에서 유의한 차이 있을 것이다.'

### 8.1 Chi-square
**무엇을 비교?**  
- 각 COG category(C, G, E)의 **total gene counts**(그룹 전체 합계)를 이용해  
- phylogroup × category로 이루어진 **contingency table**의 분포 차이를 확인.

**언제 사용?**  
- “그룹들이 가진 *총 유전자 수 비율*이 같은가?”를 비교할 때  
- 데이터가 count(정수)이고, 샘플 크기가 충분히 클 때 적절함.

**해석 기준**  
- **p < 0.05** → 각 그룹의 “COG category 전체 비율”이 다르다.

### 8.2 Kruskal–Wallis
**무엇을 비교?**  
- 각 strain(개별 genome)이 가진 **COG count distribution**  
  - 예: 한 genome이 가진 COG C 유전자 수  
- 이 값이 phylogroup 간 동일한 분포인지 확인

**언제 사용?**  
- genome 간 카운트 데이터가 정규성을 만족하지 않을 때  
- 여러 그룹의 중앙값/분포 차이를 비교할 때 사용

**해석 기준**  
- **p < 0.05** → “strain-level distribution”이 그룹마다 다름

---

## 9. Results — Chi-square & Kruskal–Wallis

### 9.1 Chi-square (총량 차이)
- **C:** p ≈ 1.2e⁻²⁷⁶  
- **G:** p ≈ 5.1e⁻²¹⁷  
- **E:** p → 1e⁻(수십) 수준
  
<img width="1200" height="1800" alt="cog_group_counts_h35_heatmap" src="https://github.com/user-attachments/assets/11df12a5-02e0-4c34-96f2-25c665d3174e" />


→ **세 기능 모두 phylogroup 간 총량 차이가 유의함.**



### 9.2 Kruskal–Wallis (strain-level)
- **C:** p ≈ 6.4e⁻⁶  
- **G:** p ≈ 3.6e⁻⁵  
- **E:** p ≈ 3.7e⁻¹¹  

<img width="2400" height="1200" alt="cog_CGE_h35_boxplot_smallfliers" src="https://github.com/user-attachments/assets/ec6d3663-d69c-4e09-b6bb-3887540719b2" />


→ **각 genome이 가진 C/G/E 구성도 그룹 간 차이가 명확함.**

---

## Hypothesis 2

앞선 분석은 절대 C/G/E 개수 차이에 대한 것이며,  
이 질문이 남는다:

> **전체 accessory gene 수를 보정해도 C/G/E 비율 차이가 유지되는가?**


---

## 10. Fisher’s Exact Test (Proportion-Based Analysis)

본 분석에서는 accessory gene 중 발효 관련 핵심 기능군(COG C, G, E)을 합산한 **CGE count**가  
각 phylogroup(H35 기준)에서 **특정 그룹에서 특이적으로 높거나 낮은지**를 확인하기 위해 수행함.

## 10.1 work flow
1. **Accessory gene count 파일**과 **strain별 C/G/E count 파일**을  
   **strain 이름 기준으로 merge**
- `accessory_gene_counts_95cutoff_geneID.tsv`  
  → strain별 total accessory gene count
- `cog_by_strain_CGE_h35_no_CP033371.tsv`  
  → strain별 C/G/E functional gene count  

3. 각 strain에 대해  
   - accessory gene total  
   - C, G, E count  
   을 모두 포함하는 dataset 구축

4. C, G, E를 합쳐  
   **CGE = C + G + E**

5. 모든 strain을 H35 기준 phylogroup 5개로 분류

6. 각 phylogroup별로 다음 값을 계산:
   - 그룹 내 CGE 유전자 수 합
   - 그룹 내 accessory 유전자 수 합

7. 각 그룹에 대해 다음 2×2 contingency table 구성:

|                | CGE genes | non-CGE accessory |
|----------------|-----------|-------------------|
| this group     | a         | b                 |
| all other grps | c         | d                 |


위 테이블을 기반으로 **Fisher’s exact test** 수행  
   → “이 그룹의 CGE 비율이 나머지보다 높은가/낮은가”를 검정
---

### 10.2 Results
<img width="1560" height="960" alt="fisher_CGE_enrichment_h35_barplot" src="https://github.com/user-attachments/assets/3875f7d2-d84f-439a-81c5-177da81f55e6" />


| Group | Odds Ratio | p-value | Interpretation |
|-------|------------|---------|----------------|
| **1** | 1.297 | 4.9e⁻20 | CGE 비율 **높음 (enriched)** |
| **2** | 0.813 | 1.1e⁻8 | **낮음 (depleted)** |
| **3** | 1.050 | 0.254 | 차이 없음 |
| **4** | 0.837 | 2.8e⁻4 | **낮음** |
| **5** | 0.853 | 4.9e⁻3 | **낮음** |

### Interpretation
- **Group 1 → 발효 관련 기능이 강화된(enriched) phylogroup**  
- **Group 2, 4, 5 → 기능적으로 감소(depleted)**  
- **Group 3 → 중립적 그룹**  

→ accessory genome 크기를 보정해도 **기능 차이는 유지됨**.



### files
-phylogroup_h35.tsv
-accessory_gene_counts_95cutoff_geneID.tsv
-cog_by_strain_CGE_h35_no_CP033371.tsv

---




